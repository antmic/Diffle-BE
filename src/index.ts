import fs from 'fs';
import csv from 'csv-parser';
const express = require('express');
import { Request, Response } from 'express';
const cors = require('cors');

const dictionaryPath = './src/dictionary/';
const winningWordsPath = './src/winning_words/';

const dictionaryFiles = [
	'aa.csv',
	'ab.csv',
	'ac.csv',
	'ad.csv',
	'ae.csv',
	'af.csv',
	'ag.csv',
	'ah.csv',
	'ai.csv',
	'aj.csv',
	'ak.csv',
	'al.csv',
	'am.csv',
	'an.csv',
	'ao.csv',
	'ap.csv',
	'ar.csv',
	'as.csv',
	'at.csv',
	'au.csv',
	'aw.csv',
	'ay.csv',
	'az.csv',
	'ać.csv',
	'ał.csv',
	'aś.csv',
	'aż.csv',
	'ba.csv',
	'be.csv',
	'bh.csv',
	'bi.csv',
	'bl.csv',
	'bn.csv',
	'bo.csv',
	'br.csv',
	'bu.csv',
	'by.csv',
	'bz.csv',
	'bó.csv',
	'bą.csv',
	'bę.csv',
	'bł.csv',
	'bź.csv',
	'bż.csv',
	'ca.csv',
	'ce.csv',
	'ch.csv',
	'ci.csv',
	'cj.csv',
	'ck.csv',
	'cl.csv',
	'cm.csv',
	'cn.csv',
	'co.csv',
	'cr.csv',
	'cu.csv',
	'cw.csv',
	'cy.csv',
	'cz.csv',
	'có.csv',
	'cą.csv',
	'cę.csv',
	'cł.csv',
	'da.csv',
	'db.csv',
	'de.csv',
	'dh.csv',
	'di.csv',
	'dj.csv',
	'dl.csv',
	'dm.csv',
	'dn.csv',
	'do.csv',
	'dr.csv',
	'du.csv',
	'dw.csv',
	'dy.csv',
	'dz.csv',
	'dó.csv',
	'dą.csv',
	'dę.csv',
	'dł.csv',
	'dź.csv',
	'dż.csv',
	'ea.csv',
	'eb.csv',
	'ec.csv',
	'ed.csv',
	'ee.csv',
	'ef.csv',
	'eg.csv',
	'eh.csv',
	'ei.csv',
	'ej.csv',
	'ek.csv',
	'el.csv',
	'em.csv',
	'en.csv',
	'eo.csv',
	'ep.csv',
	'er.csv',
	'es.csv',
	'et.csv',
	'eu.csv',
	'ew.csv',
	'ey.csv',
	'ez.csv',
	'eł.csv',
	'eń.csv',
	'eś.csv',
	'eż.csv',
	'fa.csv',
	'fe.csv',
	'ff.csv',
	'fi.csv',
	'fl.csv',
	'fo.csv',
	'fr.csv',
	'ft.csv',
	'fu.csv',
	'fy.csv',
	'fą.csv',
	'ga.csv',
	'gb.csv',
	'gd.csv',
	'ge.csv',
	'gh.csv',
	'gi.csv',
	'gj.csv',
	'gl.csv',
	'gm.csv',
	'gn.csv',
	'go.csv',
	'gr.csv',
	'gu.csv',
	'gw.csv',
	'gy.csv',
	'gz.csv',
	'gó.csv',
	'gą.csv',
	'gę.csv',
	'gł.csv',
	'gź.csv',
	'gż.csv',
	'ha.csv',
	'he.csv',
	'hi.csv',
	'hm.csv',
	'ho.csv',
	'hr.csv',
	'hu.csv',
	'hw.csv',
	'hy.csv',
	'hę.csv',
	'hł.csv',
	'ib.csv',
	'ic.csv',
	'id.csv',
	'if.csv',
	'ig.csv',
	'ih.csv',
	'ii.csv',
	'ij.csv',
	'ik.csv',
	'il.csv',
	'im.csv',
	'in.csv',
	'io.csv',
	'ip.csv',
	'ir.csv',
	'is.csv',
	'it.csv',
	'iu.csv',
	'iw.csv',
	'iz.csv',
	'ił.csv',
	'iń.csv',
	'iś.csv',
	'iż.csv',
	'ja.csv',
	'je.csv',
	'ji.csv',
	'jm.csv',
	'jo.csv',
	'ju.csv',
	'jó.csv',
	'ją.csv',
	'ję.csv',
	'ka.csv',
	'kc.csv',
	'ke.csv',
	'kh.csv',
	'ki.csv',
	'kl.csv',
	'km.csv',
	'kn.csv',
	'ko.csv',
	'kp.csv',
	'kr.csv',
	'ks.csv',
	'kt.csv',
	'ku.csv',
	'kw.csv',
	'ky.csv',
	'kó.csv',
	'ką.csv',
	'kę.csv',
	'kł.csv',
	'la.csv',
	'le.csv',
	'lg.csv',
	'lh.csv',
	'li.csv',
	'll.csv',
	'ln.csv',
	'lo.csv',
	'ls.csv',
	'lu.csv',
	'lw.csv',
	'ly.csv',
	'ló.csv',
	'lą.csv',
	'lę.csv',
	'lś.csv',
	'lż.csv',
	'ma.csv',
	'mb.csv',
	'mc.csv',
	'md.csv',
	'me.csv',
	'mg.csv',
	'mh.csv',
	'mi.csv',
	'mj.csv',
	'mk.csv',
	'ml.csv',
	'mm.csv',
	'mn.csv',
	'mo.csv',
	'mr.csv',
	'ms.csv',
	'mu.csv',
	'my.csv',
	'mó.csv',
	'mą.csv',
	'mę.csv',
	'mł.csv',
	'mś.csv',
	'mż.csv',
	'na.csv',
	'nd.csv',
	'ne.csv',
	'ng.csv',
	'ni.csv',
	'nj.csv',
	'no.csv',
	'nu.csv',
	'ny.csv',
	'nó.csv',
	'nę.csv',
	'oa.csv',
	'ob.csv',
	'oc.csv',
	'od.csv',
	'oe.csv',
	'of.csv',
	'og.csv',
	'oh.csv',
	'oi.csv',
	'oj.csv',
	'ok.csv',
	'ol.csv',
	'om.csv',
	'on.csv',
	'oo.csv',
	'op.csv',
	'or.csv',
	'os.csv',
	'ot.csv',
	'ou.csv',
	'ow.csv',
	'oz.csv',
	'oć.csv',
	'oł.csv',
	'oń.csv',
	'oś.csv',
	'oź.csv',
	'oż.csv',
	'pa.csv',
	'pc.csv',
	'pe.csv',
	'pf.csv',
	'ph.csv',
	'pi.csv',
	'pj.csv',
	'pl.csv',
	'pn.csv',
	'po.csv',
	'pr.csv',
	'ps.csv',
	'pt.csv',
	'pu.csv',
	'py.csv',
	'pó.csv',
	'pą.csv',
	'pę.csv',
	'pł.csv',
	'ra.csv',
	'rd.csv',
	're.csv',
	'rh.csv',
	'ri.csv',
	'ro.csv',
	'rt.csv',
	'ru.csv',
	'rw.csv',
	'ry.csv',
	'rz.csv',
	'ró.csv',
	'rą.csv',
	'rę.csv',
	'rż.csv',
	'sa.csv',
	'sc.csv',
	'sd.csv',
	'se.csv',
	'sf.csv',
	'sg.csv',
	'sh.csv',
	'si.csv',
	'sj.csv',
	'sk.csv',
	'sl.csv',
	'sm.csv',
	'sn.csv',
	'so.csv',
	'sp.csv',
	'sr.csv',
	'ss.csv',
	'st.csv',
	'su.csv',
	'sw.csv',
	'sy.csv',
	'sz.csv',
	'só.csv',
	'są.csv',
	'sę.csv',
	'sł.csv',
	'ta.csv',
	'tb.csv',
	'tc.csv',
	'te.csv',
	'tf.csv',
	'th.csv',
	'ti.csv',
	'tj.csv',
	'tk.csv',
	'tl.csv',
	'tm.csv',
	'tn.csv',
	'to.csv',
	'tr.csv',
	'ts.csv',
	'tu.csv',
	'tw.csv',
	'ty.csv',
	'tz.csv',
	'tó.csv',
	'tą.csv',
	'tę.csv',
	'tł.csv',
	'ua.csv',
	'ub.csv',
	'uc.csv',
	'ud.csv',
	'ue.csv',
	'uf.csv',
	'ug.csv',
	'uh.csv',
	'ui.csv',
	'uj.csv',
	'uk.csv',
	'ul.csv',
	'um.csv',
	'un.csv',
	'uo.csv',
	'up.csv',
	'ur.csv',
	'us.csv',
	'ut.csv',
	'uu.csv',
	'uw.csv',
	'uz.csv',
	'uł.csv',
	'uś.csv',
	'uź.csv',
	'uż.csv',
	'wa.csv',
	'wb.csv',
	'wc.csv',
	'wd.csv',
	'we.csv',
	'wg.csv',
	'wh.csv',
	'wi.csv',
	'wj.csv',
	'wk.csv',
	'wl.csv',
	'wm.csv',
	'wn.csv',
	'wo.csv',
	'wp.csv',
	'wr.csv',
	'ws.csv',
	'wt.csv',
	'wu.csv',
	'ww.csv',
	'wy.csv',
	'wz.csv',
	'wó.csv',
	'wą.csv',
	'wę.csv',
	'wł.csv',
	'wś.csv',
	'wż.csv',
	'ya.csv',
	'ye.csv',
	'yh.csv',
	'yi.csv',
	'yl.csv',
	'yo.csv',
	'yp.csv',
	'yu.csv',
	'yy.csv',
	'za.csv',
	'zb.csv',
	'zd.csv',
	'ze.csv',
	'zg.csv',
	'zh.csv',
	'zi.csv',
	'zj.csv',
	'zl.csv',
	'zm.csv',
	'zn.csv',
	'zo.csv',
	'zr.csv',
	'zs.csv',
	'zu.csv',
	'zw.csv',
	'zy.csv',
	'zz.csv',
	'zó.csv',
	'zą.csv',
	'zę.csv',
	'zł.csv',
	'zś.csv',
	'zż.csv',
	'óc.csv',
	'ód.csv',
	'ós.csv',
	'ów.csv',
	'óś.csv',
	'ąk.csv',
	'ća.csv',
	'će.csv',
	'ćk.csv',
	'ćm.csv',
	'ćp.csv',
	'ćw.csv',
	'ćś.csv',
	'ęs.csv',
	'ła.csv',
	'łb.csv',
	'łe.csv',
	'łg.csv',
	'łk.csv',
	'ło.csv',
	'łu.csv',
	'ły.csv',
	'łz.csv',
	'łó.csv',
	'łą.csv',
	'łę.csv',
	'łż.csv',
	'śa.csv',
	'śc.csv',
	'śi.csv',
	'śl.csv',
	'śm.csv',
	'śn.csv',
	'śp.csv',
	'śr.csv',
	'śu.csv',
	'św.csv',
	'źd.csv',
	'źg.csv',
	'źl.csv',
	'źr.csv',
	'ża.csv',
	'żb.csv',
	'żd.csv',
	'że.csv',
	'żg.csv',
	'żi.csv',
	'żl.csv',
	'żm.csv',
	'żn.csv',
	'żo.csv',
	'żr.csv',
	'żu.csv',
	'żw.csv',
	'ży.csv',
	'żó.csv',
	'żą.csv',
	'żę.csv',
	'żł.csv',
];

function binarySearch(arr: string[], x: string) {
	let start = 0;
	let end = arr.length - 1;

	// Iterate while start not meets end
	while (start <= end) {
		// Find the mid index
		let mid = Math.floor((start + end) / 2);

		// If element is present at mid, return True
		if (arr[mid] === x) return true;
		// Else look in left or right half accordingly
		else if (arr[mid] < x) start = mid + 1;
		else end = mid - 1;
	}

	return false;
}

const winningWordsFiles: [[number, number], number, string][] = [
	[[0, 0.001201361543082], 18, 'ab.csv'],
	[[0.001201361543083, 0.002335980778215], 17, 'ad.csv'],
	[[0.002335980778216, 0.002402723086164], 1, 'ae.csv'],
	[[0.002402723086165, 0.003003403857705], 9, 'af.csv'],
	[[0.003003403857706, 0.0037375692451439998], 11, 'ag.csv'],
	[[0.003737569245145, 0.0066742307949], 44, 'ak.csv'],
	[[0.006674230794901, 0.009143696189013], 37, 'al.csv'],
	[[0.009143696189013999, 0.010612026963891], 22, 'am.csv'],
	[[0.010612026963892, 0.014816792364679001], 63, 'an.csv'],
	[[0.01481679236468, 0.016285123139557], 22, 'ap.csv'],
	[[0.016285123139558, 0.019688980844956], 51, 'ar.csv'],
	[[0.019688980844957, 0.021157311619833998], 22, 'as.csv'],
	[[0.021157311619834997, 0.022358673162916], 18, 'at.csv'],
	[[0.022358673162917, 0.024227457785488], 28, 'au.csv'],
	[[0.024227457785488998, 0.024761396249079998], 8, 'aw.csv'],
	[[0.024761396249080997, 0.024961623172926998], 3, 'az.csv'],
	[[0.024961623172927997, 0.032103050123471], 107, 'ba.csv'],
	[[0.032103050123472, 0.03216979243142], 1, 'bą.csv'],
	[[0.032169792431421, 0.039911900153505], 116, 'be.csv'],
	[[0.039911900153506, 0.040379096309148], 7, 'bę.csv'],
	[[0.040379096309149, 0.045584996329171], 78, 'bi.csv'],
	[[0.045584996329172, 0.047587265567641], 30, 'bl.csv'],
	[[0.047587265567642, 0.049522792498162], 29, 'bł.csv'],
	[[0.049522792498163, 0.052392711739969], 43, 'bo.csv'],
	[[0.05239271173997, 0.052526196355867], 2, 'bó.csv'],
	[[0.052526196355868, 0.057999065607686], 82, 'br.csv'],
	[[0.057999065607687, 0.062137088700525], 62, 'bu.csv'],
	[[0.062137088700526, 0.062537542548219], 6, 'by.csv'],
	[[0.06253754254822, 0.062737769472066], 3, 'bz.csv'],
	[[0.062737769472067, 0.063538677167454], 12, 'ca.csv'],
	[[0.063538677167455, 0.066809050256955], 49, 'ce.csv'],
	[[0.06680905025695599, 0.066942534872853], 2, 'cę.csv'],
	[[0.066942534872854, 0.07621971567776499], 139, 'ch.csv'],
	[[0.07621971567776599, 0.080357738770604], 62, 'ci.csv'],
	[[0.080357738770605, 0.080491223386502], 2, 'ck.csv'],
	[[0.080491223386503, 0.08055796569445099], 1, 'cl.csv'],
	[[0.08055796569445199, 0.080691450310349], 2, 'cm.csv'],
	[[0.08069145031035, 0.08089167723419599], 3, 'cn.csv'],
	[[0.08089167723419699, 0.08189281185343099], 15, 'co.csv'],
	[[0.08189281185343199, 0.08195955416137998], 1, 'có.csv'],
	[[0.08195955416138098, 0.08322765801241098], 19, 'cu.csv'],
	[[0.08322765801241198, 0.08329440032035998], 1, 'cw.csv'],
	[[0.08329440032036098, 0.08362811186010498], 5, 'ćw.csv'],
	[[0.08362811186010598, 0.08569712340652398], 31, 'cy.csv'],
	[[0.08569712340652498, 0.09363945805245598], 119, 'cz.csv'],
	[[0.09363945805245698, 0.09510778882733398], 22, 'da.csv'],
	[[0.09510778882733498, 0.09517453113528297], 1, 'dą.csv'],
	[[0.09517453113528397, 0.10224921577787797], 106, 'de.csv'],
	[[0.10224921577787897, 0.10231595808582697], 1, 'dę.csv'],
	[[0.10231595808582797, 0.10345057732095997], 17, 'di.csv'],
	[[0.10345057732096097, 0.10358406193685797], 2, 'dl.csv'],
	[[0.10358406193685897, 0.10458519655609297], 15, 'dł.csv'],
	[[0.10458519655609397, 0.11933524661282396], 221, 'do.csv'],
	[[0.11933524661282496, 0.12434091970899996], 75, 'dr.csv'],
	[[0.12434091970900096, 0.12580925048387798], 22, 'du.csv'],
	[[0.12580925048387898, 0.12687712741106197], 16, 'dw.csv'],
	[[0.12687712741106297, 0.13181605819928896], 74, 'dy.csv'],
	[[0.13181605819928996, 0.13895748514983297], 107, 'dz.csv'],
	[[0.13895748514983397, 0.13969165053727198], 11, 'dź.csv'],
	[[0.13969165053727298, 0.14035907361676198], 10, 'dż.csv'],
	[[0.14035907361676297, 0.14049255823265996], 2, 'ed.csv'],
	[[0.14049255823266096, 0.14069278515650696], 3, 'ef.csv'],
	[[0.14069278515650796, 0.14189414669958897], 18, 'eg.csv'],
	[[0.14189414669958997, 0.14643262364012197], 68, 'ek.csv'],
	[[0.14643262364012297, 0.14843489287859196], 30, 'el.csv'],
	[[0.14843489287859296, 0.15010345057731697], 25, 'em.csv'],
	[[0.15010345057731797, 0.15097110058065397], 13, 'en.csv'],
	[[0.15097110058065497, 0.15183875058399096], 13, 'ep.csv'],
	[[0.15183875058399196, 0.15223920443168495], 6, 'er.csv'],
	[[0.15223920443168595, 0.15317359674297096], 14, 'es.csv'],
	[[0.15317359674297196, 0.15370753520656297], 8, 'et.csv'],
	[[0.15370753520656397, 0.15437495828605297], 10, 'eu.csv'],
	[[0.15437495828605396, 0.15504238136554296], 10, 'ew.csv'],
	[[0.15504238136554396, 0.15510912367349197], 1, 'ez.csv'],
	[[0.15510912367349297, 0.15958085830607596], 67, 'fa.csv'],
	[[0.15958085830607696, 0.16084896215710695], 19, 'fe.csv'],
	[[0.16084896215710795, 0.16505372755789496], 63, 'fi.csv'],
	[[0.16505372755789596, 0.16678902756456895], 26, 'fl.csv'],
	[[0.16678902756456995, 0.16985917373022294], 46, 'fo.csv'],
	[[0.16985917373022394, 0.17152773142894795], 25, 'fr.csv'],
	[[0.17152773142894895, 0.17306280451177494], 23, 'fu.csv'],
	[[0.17306280451177594, 0.17660014683307193], 53, 'ga.csv'],
	[[0.17660014683307293, 0.17693385837281694], 5, 'gą.csv'],
	[[0.17693385837281794, 0.17720082760461295], 4, 'gd.csv'],
	[[0.17720082760461395, 0.17900286991923595], 27, 'ge.csv'],
	[[0.17900286991923695, 0.17933658145898096], 5, 'gę.csv'],
	[[0.17933658145898196, 0.18053794300206297], 18, 'gi.csv'],
	[[0.18053794300206397, 0.18153907762129798], 15, 'gl.csv'],
	[[0.18153907762129898, 0.18394180070746197], 36, 'gł.csv'],
	[[0.18394180070746297, 0.18407528532335996], 2, 'gm.csv'],
	[[0.18407528532336095, 0.18474270840284995], 10, 'gn.csv'],
	[[0.18474270840285095, 0.18801308149235096], 49, 'go.csv'],
	[[0.18801308149235196, 0.18848027764799397], 7, 'gó.csv'],
	[[0.18848027764799496, 0.19522125075084396], 101, 'gr.csv'],
	[[0.19522125075084495, 0.19608890075418095], 13, 'gu.csv'],
	[[0.19608890075418195, 0.19729026229726296], 18, 'gw.csv'],
	[[0.19729026229726396, 0.20036040846291694], 46, 'ha.csv'],
	[[0.20036040846291794, 0.20189548154574394], 23, 'he.csv'],
	[[0.20189548154574494, 0.20383100847626492], 29, 'hi.csv'],
	[[0.20383100847626592, 0.20650070079422492], 40, 'ho.csv'],
	[[0.20650070079422592, 0.20656744310217393], 1, 'hr.csv'],
	[[0.20656744310217492, 0.20796903156910293], 21, 'hu.csv'],
	[[0.20796903156910393, 0.20830274310884794], 5, 'hy.csv'],
	[[0.20830274310884894, 0.20836948541679695], 1, 'ib.csv'],
	[[0.20836948541679795, 0.20963758926782794], 19, 'id.csv'],
	[[0.20963758926782894, 0.21023827003936893], 9, 'ig.csv'],
	[[0.21023827003936993, 0.21030501234731794], 1, 'ik.csv'],
	[[0.21030501234731894, 0.21103917773475694], 11, 'il.csv'],
	[[0.21103917773475794, 0.21370887005271694], 40, 'im.csv'],
	[[0.21370887005271794, 0.22158446239069993], 118, 'in.csv'],
	[[0.22158446239070093, 0.2223853700860879], 12, 'ir.csv'],
	[[0.2223853700860889, 0.2230527931655779], 10, 'is.csv'],
	[[0.2230527931655789, 0.22331976239737392], 4, 'iz.csv'],
	[[0.22331976239737492, 0.2273910431822639], 61, 'ja.csv'],
	[[0.2273910431822649, 0.2275245277981619], 2, 'ją.csv'],
	[[0.2275245277981629, 0.2311286124274079], 54, 'je.csv'],
	[[0.2311286124274089, 0.2316625508909999], 8, 'ję.csv'],
	[[0.2316625508910009, 0.2321297470466429], 7, 'jo.csv'],
	[[0.2321297470466439, 0.23286391243408192], 11, 'ju.csv'],
	[[0.23286391243408291, 0.24674631248747592], 208, 'ka.csv'],
	[[0.24674631248747692, 0.24728025095106793], 8, 'ką.csv'],
	[[0.24728025095106893, 0.24734699325901693], 1, 'kc.csv'],
	[[0.24734699325901793, 0.24774744710671093], 6, 'ke.csv'],
	[[0.24774744710671193, 0.24788093172260892], 2, 'kę.csv'],
	[[0.24788093172260992, 0.24794767403055792], 1, 'kh.csv'],
	[[0.24794767403055892, 0.2508843355803139], 44, 'ki.csv'],
	[[0.2508843355803149, 0.25468864713340794], 57, 'kl.csv'],
	[[0.25468864713340894, 0.25595675098443893], 19, 'kł.csv'],
	[[0.25595675098443993, 0.25602349329238794], 1, 'km.csv'],
	[[0.25602349329238894, 0.2563572048321329], 5, 'kn.csv'],
	[[0.2563572048321339, 0.2823199626242969], 389, 'ko.csv'],
	[[0.2823199626242979, 0.28238670493224594], 1, 'kó.csv'],
	[[0.28238670493224693, 0.28252018954814395], 2, 'kp.csv'],
	[[0.28252018954814495, 0.29119668958151496], 130, 'kr.csv'],
	[[0.29119668958151596, 0.29313221651203597], 29, 'ks.csv'],
	[[0.29313221651203697, 0.29359941266767897], 7, 'kt.csv'],
	[[0.29359941266767997, 0.29686978575718], 49, 'ku.csv'],
	[[0.296869785757181, 0.299339251151293], 37, 'kw.csv'],
	[[0.299339251151294, 0.30154174731361], 33, 'la.csv'],
	[[0.301541747313611, 0.301808716545406], 4, 'lą.csv'],
	[[0.301808716545407, 0.30481212040311095], 45, 'ła.csv'],
	[[0.30481212040311195, 0.30514583194285594], 5, 'łą.csv'],
	[[0.30514583194285694, 0.30881665888005094], 55, 'le.csv'],
	[[0.30881665888005194, 0.30895014349594896], 2, 'lę.csv'],
	[[0.30895014349594996, 0.30901688580389797], 1, 'łe.csv'],
	[[0.30901688580389897, 0.309083628111847], 1, 'łg.csv'],
	[[0.309083628111848, 0.313288393512635], 63, 'li.csv'],
	[[0.313288393512636, 0.313355135820584], 1, 'łk.csv'],
	[[0.313355135820585, 0.313421878128533], 1, 'ln.csv'],
	[[0.313421878128534, 0.315691116598799], 34, 'lo.csv'],
	[[0.3156911165988, 0.316625508910085], 14, 'ło.csv'],
	[[0.316625508910086, 0.316692251218034], 1, 'łó.csv'],
	[[0.316692251218035, 0.31682573583393203], 2, 'lś.csv'],
	[[0.31682573583393303, 0.31836080891675905], 23, 'lu.csv'],
	[[0.31836080891676005, 0.31922845892009605], 13, 'łu.csv'],
	[[0.31922845892009705, 0.31929520122804506], 1, 'lw.csv'],
	[[0.31929520122804605, 0.3198958819995861], 9, 'ły.csv'],
	[[0.3198958819995871, 0.3200293666154841], 2, 'łz.csv'],
	[[0.3200293666154851, 0.3321764666622041], 182, 'ma.csv'],
	[[0.33217646666220507, 0.33244343589400005], 4, 'mą.csv'],
	[[0.33244343589400105, 0.3326436628178471], 3, 'md.csv'],
	[[0.3326436628178481, 0.3373156243742781], 70, 'me.csv'],
	[[0.3373156243742791, 0.3379830474537681], 10, 'mę.csv'],
	[[0.3379830474537691, 0.33811653206966613], 2, 'mg.csv'],
	[[0.33811653206966713, 0.34772742441432314], 144, 'mi.csv'],
	[[0.34772742441432414, 0.34779416672227215], 1, 'mk.csv'],
	[[0.34779416672227315, 0.34812787826201713], 5, 'ml.csv'],
	[[0.34812787826201813, 0.3489287859574051], 12, 'mł.csv'],
	[[0.3489287859574061, 0.3496629513448441], 11, 'mn.csv'],
	[[0.3496629513448451, 0.3568043782953881], 107, 'mo.csv'],
	[[0.3568043782953891, 0.3572048321430821], 6, 'mó.csv'],
	[[0.3572048321430831, 0.35800573983847006], 12, 'mr.csv'],
	[[0.35800573983847106, 0.3581392244543681], 2, 'mś.csv'],
	[[0.3581392244543691, 0.36034172061668507], 33, 'mu.csv'],
	[[0.36034172061668607, 0.3613428552359201], 15, 'my.csv'],
	[[0.3613428552359211, 0.3614095975438691], 1, 'mż.csv'],
	[[0.3614095975438701, 0.3829673630113991], 323, 'na.csv'],
	[[0.3829673630114001, 0.3845691784021751], 24, 'ne.csv'],
	[[0.3845691784021761, 0.38490288994192007], 5, 'nę.csv'],
	[[0.38490288994192107, 0.4178068477607811], 493, 'ni.csv'],
	[[0.4178068477607821, 0.4212107054661801], 51, 'no.csv'],
	[[0.4212107054661811, 0.4212774477741291], 1, 'nó.csv'],
	[[0.4212774477741301, 0.4222118400854151], 14, 'nu.csv'],
	[[0.4222118400854161, 0.42227858239336413], 1, 'ny.csv'],
	[[0.42227858239336513, 0.4343589401321351], 181, 'ob.csv'],
	[[0.4343589401321361, 0.4368951478341971], 38, 'oc.csv'],
	[[0.4368951478341981, 0.45271307481811207], 237, 'od.csv'],
	[[0.45271307481811307, 0.4537142094373471], 15, 'of.csv'],
	[[0.4537142094373481, 0.4570513248347971], 50, 'og.csv'],
	[[0.4570513248347981, 0.4571180671427461], 1, 'oh.csv'],
	[[0.4571180671427471, 0.4575185209904401], 6, 'oj.csv'],
	[[0.4575185209904411, 0.4610558633117371], 53, 'ok.csv'],
	[[0.4610558633117381, 0.4619902556230231], 14, 'ol.csv'],
	[[0.4619902556230241, 0.4621904825468701], 3, 'oł.csv'],
	[[0.4621904825468711, 0.46279116331841114], 9, 'om.csv'],
	[[0.46279116331841214, 0.46292464793430915], 2, 'on.csv'],
	[[0.46292464793431015, 0.46933190949741416], 96, 'op.csv'],
	[[0.46933190949741516, 0.47246879797101715], 47, 'or.csv'],
	[[0.47246879797101815, 0.4794767403056632], 105, 'os.csv'],
	[[0.4794767403056642, 0.4804111326169492], 14, 'oś.csv'],
	[[0.4804111326169502, 0.48201294800772515], 24, 'ot.csv'],
	[[0.48201294800772615, 0.48261362877926617], 9, 'ow.csv'],
	[[0.48261362877926717, 0.4826803710872152], 1, 'ów.csv'],
	[[0.4826803710872162, 0.48354802109055217], 13, 'oz.csv'],
	[[0.48354802109055317, 0.48381499032234815], 4, 'oż.csv'],
	[[0.48381499032234915, 0.4986317826870281], 222, 'pa.csv'],
	[[0.4986317826870291, 0.49876526730292614], 2, 'pą.csv'],
	[[0.49876526730292714, 0.4990989788426711], 5, 'pc.csv'],
	[[0.4990989788426721, 0.5043048788626942], 78, 'pe.csv'],
	[[0.5043048788626951, 0.5051057865580821], 12, 'pę.csv'],
	[[0.5051057865580831, 0.5151171327504331], 150, 'pi.csv'],
	[[0.5151171327504341, 0.5195888673830171], 67, 'pl.csv'],
	[[0.5195888673830181, 0.5233931789361111], 57, 'pł.csv'],
	[[0.5233931789361121, 0.5235266635520092], 2, 'pn.csv'],
	[[0.5235266635520102, 0.5764533137555732], 793, 'po.csv'],
	[[0.5764533137555742, 0.5778549022225021], 21, 'pó.csv'],
	[[0.5778549022225031, 0.6366548755255791], 881, 'pr.csv'],
	[[0.6366548755255801, 0.6383234332243041], 25, 'ps.csv'],
	[[0.6383234332243051, 0.6384569178402021], 2, 'pt.csv'],
	[[0.6384569178402031, 0.641794033237652], 50, 'pu.csv'],
	[[0.641794033237653, 0.642394714009193], 9, 'py.csv'],
	[[0.642394714009194, 0.647066675565624], 70, 'ra.csv'],
	[[0.647066675565625, 0.6473336447974201], 4, 'rą.csv'],
	[[0.6473336447974211, 0.6474003871053691], 1, 'rd.csv'],
	[[0.6474003871053701, 0.6594807448441401], 181, 're.csv'],
	[[0.6594807448441411, 0.6601481679236301], 10, 'rę.csv'],
	[[0.6601481679236311, 0.6602149102315791], 1, 'ri.csv'],
	[[0.6602149102315801, 0.6813722218514151], 317, 'ro.csv'],
	[[0.6813722218514161, 0.6837082026296301], 35, 'ró.csv'],
	[[0.6837082026296311, 0.6859774410998961], 34, 'ru.csv'],
	[[0.6859774410998971, 0.6881131949542642], 32, 'ry.csv'],
	[[0.6881131949542652, 0.6911165988119692], 45, 'rz.csv'],
	[[0.6911165988119702, 0.6960555296001962], 74, 'sa.csv'],
	[[0.6960555296001972, 0.6967229526796862], 10, 'są.csv'],
	[[0.6967229526796872, 0.6985917373022582], 28, 'sc.csv'],
	[[0.6985917373022592, 0.7002602950009832], 25, 'śc.csv'],
	[[0.7002602950009842, 0.7041980911699752], 59, 'se.csv'],
	[[0.7041980911699762, 0.7044650604017713], 4, 'sę.csv'],
	[[0.7044650604017723, 0.7046652873256183], 3, 'sf.csv'],
	[[0.7046652873256193, 0.7047320296335673], 1, 'sh.csv'],
	[[0.7047320296335683, 0.7079356604151192], 48, 'si.csv'],
	[[0.7079356604151202, 0.7080024027230682], 1, 'sj.csv'],
	[[0.7080024027230692, 0.7174798104518273], 142, 'sk.csv'],
	[[0.7174798104518283, 0.7178135219915723], 5, 'sl.csv'],
	[[0.7178135219915733, 0.7212841220049203], 52, 'sł.csv'],
	[[0.7212841220049213, 0.7227524527797983], 22, 'śl.csv'],
	[[0.7227524527797993, 0.7240205566308293], 19, 'sm.csv'],
	[[0.7240205566308303, 0.7255556297136563], 23, 'śm.csv'],
	[[0.7255556297136573, 0.7257558566375033], 3, 'sn.csv'],
	[[0.7257558566375043, 0.7260895681772483], 5, 'śn.csv'],
	[[0.7260895681772493, 0.7280250951077694], 29, 'so.csv'],
	[[0.7280250951077704, 0.7399719682306424], 179, 'sp.csv'],
	[[0.7399719682306434, 0.7405726490021833], 9, 'śp.csv'],
	[[0.7405726490021843, 0.7406393913101323], 1, 'sq.csv'],
	[[0.7406393913101333, 0.7411065874657753], 7, 'sr.csv'],
	[[0.7411065874657763, 0.7421744643929593], 16, 'śr.csv'],
	[[0.7421744643929603, 0.7423079490088573], 2, 'ss.csv'],
	[[0.7423079490088583, 0.7579923913768744], 235, 'st.csv'],
	[[0.7579923913768754, 0.7613962490822733], 51, 'su.csv'],
	[[0.7613962490822743, 0.7619969298538143], 9, 'sw.csv'],
	[[0.7619969298538153, 0.7651338183274173], 47, 'św.csv'],
	[[0.7651338183274183, 0.7686044183407653], 52, 'sy.csv'],
	[[0.7686044183407663, 0.7877594607221313], 287, 'sz.csv'],
	[[0.7877594607221323, 0.7922979376626643], 68, 'ta.csv'],
	[[0.7922979376626653, 0.7924981645865113], 3, 'tc.csv'],
	[[0.7924981645865123, 0.7981045184542284], 84, 'te.csv'],
	[[0.7981045184542294, 0.7986384569178203], 8, 'tę.csv'],
	[[0.7986384569178213, 0.7987051992257693], 1, 'ti.csv'],
	[[0.7987051992257703, 0.7989054261496163], 3, 'tk.csv'],
	[[0.7989054261496173, 0.7989721684575654], 1, 'tl.csv'],
	[[0.7989721684575664, 0.7999733030768004], 15, 'tł.csv'],
	[[0.7999733030768014, 0.8028432223186074], 43, 'to.csv'],
	[[0.8028432223186084, 0.8124541146632643], 144, 'tr.csv'],
	[[0.8124541146632653, 0.8142561569778873], 27, 'tu.csv'],
	[[0.8142561569778883, 0.8153240339050714], 16, 'tw.csv'],
	[[0.8153240339050724, 0.8175265300673884], 33, 'ty.csv'],
	[[0.8175265300673894, 0.8187946339184194], 19, 'ub.csv'],
	[[0.8187946339184204, 0.8215310685443284], 41, 'uc.csv'],
	[[0.8215310685443294, 0.8233998531669005], 28, 'ud.csv'],
	[[0.8233998531669015, 0.8240005339384414], 9, 'ug.csv'],
	[[0.8240005339384424, 0.8240672762463904], 1, 'uh.csv'],
	[[0.8240672762463914, 0.8246679570179314], 9, 'uj.csv'],
	[[0.8246679570179324, 0.8264032570246054], 26, 'uk.csv'],
	[[0.8264032570246064, 0.8275378762597384], 17, 'ul.csv'],
	[[0.8275378762597394, 0.8280718147233304], 8, 'uł.csv'],
	[[0.8280718147233314, 0.8300073416538514], 29, 'um.csv'],
	[[0.8300073416538524, 0.8316758993525764], 25, 'un.csv'],
	[[0.8316758993525774, 0.8320763532002704], 6, 'uo.csv'],
	[[0.8320763532002714, 0.8354134685977204], 50, 'up.csv'],
	[[0.8354134685977214, 0.8372822532202924], 28, 'ur.csv'],
	[[0.8372822532202934, 0.8406193686177423], 50, 'us.csv'],
	[[0.8406193686177433, 0.8411533070813343], 8, 'uś.csv'],
	[[0.8411533070813353, 0.8427551224721103], 24, 'ut.csv'],
	[[0.8427551224721113, 0.8444904224787843], 26, 'uw.csv'],
	[[0.8444904224787853, 0.8458252686377643], 20, 'uz.csv'],
	[[0.8458252686377653, 0.8464259494093053], 9, 'uż.csv'],
	[[0.8464259494093063, 0.8464926917172543], 1, 'va.csv'],
	[[0.8464926917172553, 0.8466261763331523], 2, 've.csv'],
	[[0.8466261763331533, 0.8466929186411013], 1, 'vi.csv'],
	[[0.8466929186411023, 0.8508309417339402], 62, 'wa.csv'],
	[[0.8508309417339412, 0.8516318494293282], 12, 'wą.csv'],
	[[0.8516318494293292, 0.8518988186611243], 4, 'wb.csv'],
	[[0.8518988186611253, 0.8531001802042063], 18, 'wc.csv'],
	[[0.8531001802042073, 0.8537008609757473], 9, 'wd.csv'],
	[[0.8537008609757483, 0.8568377494493503], 47, 'we.csv'],
	[[0.8568377494493513, 0.8579723686844833], 17, 'wę.csv'],
	[[0.8579723686844843, 0.8582393379162794], 4, 'wg.csv'],
	[[0.8582393379162804, 0.8583060802242284], 1, 'wh.csv'],
	[[0.8583060802242294, 0.8692518187278654], 164, 'wi.csv'],
	[[0.8692518187278664, 0.8694520456517124], 3, 'wj.csv'],
	[[0.8694520456517134, 0.8698524994994065], 6, 'wk.csv'],
	[[0.8698524994994075, 0.8718547687378765], 30, 'wł.csv'],
	[[0.8718547687378775, 0.8719215110458255], 1, 'wm.csv'],
	[[0.8719215110458265, 0.8727224187412135], 12, 'wn.csv'],
	[[0.8727224187412145, 0.8752586264432755], 38, 'wo.csv'],
	[[0.8752586264432765, 0.8754588533671225], 3, 'wó.csv'],
	[[0.8754588533671235, 0.8771274110658475], 25, 'wp.csv'],
	[[0.8771274110658485, 0.8788627110725215], 26, 'wr.csv'],
	[[0.8788627110725225, 0.8848695187879324], 90, 'ws.csv'],
	[[0.8848695187879334, 0.8852032303276774], 5, 'wś.csv'],
	[[0.8852032303276784, 0.8860041380230654], 12, 'wt.csv'],
	[[0.8860041380230664, 0.8862711072548615], 4, 'wu.csv'],
	[[0.8862711072548625, 0.9213108189280914], 525, 'wy.csv'],
	[[0.9213108189280924, 0.9245144497096434], 48, 'wz.csv'],
	[[0.9245144497096444, 0.9627577921644254], 573, 'za.csv'],
	[[0.9627577921644264, 0.9629580190882724], 3, 'zą.csv'],
	[[0.9629580190882734, 0.9644930921710994], 23, 'ża.csv'],
	[[0.9644930921711004, 0.9647600614028954], 4, 'żą.csv'],
	[[0.9647600614028964, 0.9672962691049574], 38, 'zb.csv'],
	[[0.9672962691049584, 0.9712340652739494], 59, 'zd.csv'],
	[[0.9712340652739504, 0.9713008075818984], 1, 'źd.csv'],
	[[0.9713008075818994, 0.9737702729760114], 37, 'ze.csv'],
	[[0.9737702729760124, 0.9739704998998584], 3, 'zę.csv'],
	[[0.9739704998998594, 0.9753053460588385], 20, 'że.csv'],
	[[0.9753053460588395, 0.9775078422211555], 33, 'zg.csv'],
	[[0.9775078422211565, 0.9775745845291045], 1, 'zh.csv'],
	[[0.9775745845291055, 0.9791763999198805], 24, 'zi.csv'],
	[[0.9791763999198815, 0.9797770806914214], 9, 'zj.csv'],
	[[0.9797770806914224, 0.9800440499232175], 4, 'zl.csv'],
	[[0.9800440499232185, 0.9817793499298915], 26, 'zł.csv'],
	[[0.9817793499298925, 0.9819128345457895], 2, 'żł.csv'],
	[[0.9819128345457905, 0.9843822999399024], 37, 'zm.csv'],
	[[0.9843822999399034, 0.9845157845558005], 2, 'żm.csv'],
	[[0.9845157845558015, 0.9876526730294035], 47, 'zn.csv'],
	[[0.9876526730294045, 0.9878528999532505], 3, 'żn.csv'],
	[[0.9878528999532515, 0.9887872922645365], 14, 'zo.csv'],
	[[0.9887872922645375, 0.9893212307281285], 8, 'żo.csv'],
	[[0.9893212307281295, 0.9895881999599245], 4, 'żó.csv'],
	[[0.9895881999599255, 0.9913234999665985], 26, 'zr.csv'],
	[[0.9913234999665995, 0.9915237268904455], 3, 'źr.csv'],
	[[0.9915237268904465, 0.9915904691983946], 1, 'żr.csv'],
	[[0.9915904691983956, 0.9919241807381396], 5, 'zs.csv'],
	[[0.9919241807381406, 0.9924581192017315], 8, 'zu.csv'],
	[[0.9924581192017325, 0.9925916038176296], 2, 'żu.csv'],
	[[0.9925916038176306, 0.9977307615297035], 77, 'zw.csv'],
	[[0.9977307615297045, 0.9978642461456015], 2, 'żw.csv'],
	[[0.9978642461456025, 0.9980644730694486], 3, 'zy.csv'],
	[[0.9980644730694496, 0.9999332576920206], 28, 'ży.csv'],
	[[0.9999332576920216, 1], 1, 'zż.csv'],
];

const randomWord = async () => {
	const randomNum = +Math.random().toFixed(15);
	const winningWordsFile: [number, string] = binarySearchWinningWordFile(winningWordsFiles, randomNum);
	const chosenFileLength: number = winningWordsFile[0] as unknown as number;
	const chosenFile: string = winningWordsFile[1] as unknown as string;
	const chosenWord = await getWord(winningWordsPath, chosenFile, chosenFileLength);
	return chosenWord;
};

const getWord = async (filePath: string, fileName: string, fileLength: number): Promise<string> => {
	const randomIndex = Math.floor(Math.random() * fileLength);
	return getCSVValueAtIndex(filePath + fileName, randomIndex)
		.then(row => {
			return row;
		})
		.catch(error => {
			console.error(error);
			throw error;
		});
};

const getCSVValueAtIndex = async (filePath: string, index: number): Promise<string> => {
	return new Promise((resolve, reject) => {
		let count = 0;
		fs.createReadStream(filePath)
			.pipe(csv({ headers: false }))
			.on('data', row => {
				if (count === index) {
					resolve(Object.values(row)[0] as string);
				}
				count++;
			})
			.on('end', () => {})
			.on('error', reject);
	});
};

const getCSVSpecificValue = async (filePath: string, value: string): Promise<boolean> => {
	return new Promise((resolve, reject) => {
		let found = false;
		fs.createReadStream(filePath)
			.pipe(csv({ headers: false }))
			.on('data', row => {
				if ((row[0] as string) === value) {
					found = true;
					resolve(true);
				}
			})
			.on('end', () => {
				if (!found) {
					resolve(false);
				}
			})
			.on('error', reject);
	});
};

const binarySearchWinningWordFile = (arr: [[number, number], number, string][], target: number): [number, string] => {
	let left = 0;
	let right = 358;

	while (left <= right) {
		const mid = Math.floor((left + right) / 2);
		const guessStart = arr[mid][0][0];
		const guessEnd = arr[mid][0][1];

		//const comparison = guess.localeCompare(target);
		let comparison = 0;
		if (guessStart <= target && target < guessEnd) {
			comparison = 0;
		} else if (guessStart > target) {
			comparison = 1;
		} else {
			comparison = -1;
		}

		if (comparison === 0) {
			return [arr[mid][1] as number, arr[mid][2] as string];
		}

		if (comparison < 0) {
			left = mid + 1;
		} else {
			right = mid - 1;
		}
	}

	return [0, ''];
};

const checkWord = async (word: string): Promise<boolean> => {
	const fileName = word.slice(0, 2) + '.csv';
	let result = false;
	if (binarySearch(dictionaryFiles, fileName)) {
		result = await getCSVSpecificValue(dictionaryPath + fileName, word);
	}
	return result;
};

// server requests
const app = express();
app.use(cors());
app.use(express.json());

app.get('/getword', async (req: Request, res: Response) => {
	let result: string | null = await randomWord();
	res.json({ word: result });
	// Remove reference to result
	result = null;
});

app.post('/checkword', async (req: Request, res: Response) => {
	let result: boolean | null = await checkWord(req.body.word);
	res.json({ message: result });
	// Remove reference to result
	result = null;
});

app.listen(3000, () => {
	console.log('Server is running on port 3000');
});
